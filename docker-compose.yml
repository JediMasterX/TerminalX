version: '3.8'

services:
  terminalx:
    image: terminalx:1.1.3.3
    container_name: terminalx
    # Expose the same port your FastAPI app listens on (8087 by default)
    ports:
      - '8087:8087'
    restart: unless-stopped
    # If you need to mount local config, uncomment & adjust:
    #volumes:
    #   - ./config.json:/app/config.json:ro
    #   - ./static:/app/static:ro
    #   - ./templates:/app/templates:ro
    environment:
      - TD_PATH=/sources/indot.html
      - MOBY_PORT=9085
      # SFTP Configuration - Add these lines
      - SFTP_HOST=                    # Leave empty to use current hostname (recommended)
      - SFTP_PORT=3000               # Port where sftp-browser service runs
      - SFTP_PROTOCOL=http           # Force HTTP to avoid SSL errors
      # Token minting secret used to encrypt SFTP tokens (must match sftp-browser)
      - TOKEN_SECRET=${TOKEN_SECRET:-change_me_set_in_.env}
      # Optional: max TTL the TerminalX side will mint (seconds)
      - TOKEN_TTL_SECONDS=120
      
  sftp-browser:
    image: sftp-server:1.0.2.1
    container_name: sftp-server
    # Expose the port that SFTP-Browser serves its HTTP UI on (8261)
    ports:
      - '3000:3000'
    restart: unless-stopped
    environment:
      # Must match terminalx TOKEN_SECRET for decryption
      - TOKEN_SECRET=${TOKEN_SECRET:-change_me_set_in_.env}
      # Optional: server-side TTL enforcement (seconds)
      - TOKEN_MAX_TTL_SECONDS=300
      # Optional: session timeout for idle SFTP connections (ms)
      - SESSION_TIMEOUT=600000
    #volumes:
    #   - ./web:/app/web:ro
